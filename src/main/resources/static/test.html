<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>layui</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="layui/css/layui.css"  media="all">
    <!-- 注意：如果你直接复制所有代码到本地，上述css路径需要改成你本地的 -->
</head>
<body>
<!--
<table class="layui-hide" id="test"></table>


<script src="layui/layui.js" charset="utf-8"></script>
 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的



<script>
    layui.use('table', function(){
        var table = layui.table;

        table.render({
            elem: '#test'
            ,url:'http://localhost:8080/service/find.book'
            ,cols: [[
                {field:'img', width:80, title: '封面'}
                ,{field:'username', width:80, title: '书名'}
                ,{field:'author', width:80, title: '作者'}
                ,{field:'publisher', width:80, title: '出版社'}
                ,{field:'experience', width:80, title: '更多'}
            ]]
            ,page: true
        });
    });
</script>
-->

    <script type = "text/javascript">
    window.onload = function()
    {

        let loginJson = {
            "msg": null,
            "password": null
        };
        console.log(findbookJson);
        console.log(JSON.stringify(findbookJson));
        $.ajax({
            type: "POST",
            url: "http://localhost:8080/service/find.book",
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify(findbookJson),
            dataType: "json",
            success: function (res) {
                console.log(res);
                //如果获取不到用户类别则为登录失败
                if (res.msg==="ERROR_INPUTDATA" ) {
                    alert("数据传输失败")
                }else if(res.msg===("ERROR_SERVER")){
                    alert("服务器内部错误")
                }
                else if(res.msg==="SUCCESS"){//登录成功
                    //设置登录类别
                    sessionStorage.setItem("userType", res.type);
                    sessionStorage.setItem("userName", res.name);
                    sessionStorage.setItem("userAccount",  $("#account").val());
                    //alert(res.type+res.name);
                    //alert(window.location.href.substring(0, window.location.href.lastIndexOf('/')) + "/main.html")
                    window.location.replace(window.location.href.substring(0, window.location.href.lastIndexOf('/')) + "/main.html")

                }
            },
            error: function (XMLHttpRequest, textStatus) {
                alert("与服务器通讯失败！请刷新重试！");
                console.error(textStatus + ":" + XMLHttpRequest.status + " " + XMLHttpRequest.readyState);
            }

        })
    }

</script>
<table class="layui-table" lay-data="{width: 892, height:332, url:'/demo/table/res/', page:true, id:'idTest'}" lay-filter="demo">
    <thead>
      <tr>
        <th lay-data="{field:'img', width:80, title: '封面'}">封面</th>
        <th lay-data="{field:'bookname', width:80, title: '书名'}">书名</th>
        <th lay-data="{field:'author', width:80, title: '作者'}">作者</th>
        <th lay-data="{field:'publisher', width:80, title: '出版社'}">出版社</th>
        <th lay-data="{field:'sign', width:160}">签名</th>
        <th lay-data="{field:'experience', width:80, sort: true}">积分</th>
        
        <th lay-data="{field:'classify', width:80}">职业</th>
        <th lay-data="{field:'wealth', width:135, sort: true}">财富</th>
        <th lay-data="{field:'score', width:80, sort: true, fixed: 'right'}">评分</th>
        <th lay-data="{fixed: 'right', width:178, align:'center', toolbar: '#barDemo'}"></th>
      </tr>
    </thead>
  </table>
   
  <script id="barDemo" type="text/html">
    <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">查看</a>
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
  </script>
                 
            
  <script src="layui/layui.js" charset="utf-8"></script>
  <!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->
  <script>
  layui.use('table', function(){
    var table = layui.table;
    //监听工具条
    table.on('tool(demo)', function(obj){
      var data = obj.data;
      if(obj.event === 'detail'){
        layer.msg('bookname：'+ res.isbn + ' 的查看操作');
      } else if(obj.event === 'del'){
        layer.confirm('真的删除行么', function(index){
          obj.del();
          layer.close(index);
        });
      } else if(obj.event === 'edit'){
        layer.alert('编辑行：<br>'+ JSON.stringify(data))
      }
    });
    $('.demoTable .layui-btn').on('click', function(){
      var type = $(this).data('type');
      active[type] ? active[type].call(this) : '';
    });
  });
  </script>
</body>
</html>