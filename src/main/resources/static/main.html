<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>图书管理系统</title>
    <link rel="stylesheet" type="text/css" href="css/global.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/bootstrap.css">
</head>
<body>

<div class="header_bg" id="home">
    <div class="container">
        <div class="row header text-center specials">
            <div class="h_logo">
                <img src="imgs/logo.png" alt="" class="responsive"/>
            </div>
            <div class="top-nav" id="nav">
                <ul class="top-nav nav-list">
                    <li id="left_btn4"><a href=""></a></li>
                    <li id="left_btn3"><a href=""></a></li>
                    <li id="left_btn2"><a href=""></a></li>
                    <li><a href="login.html" id="left_btn">登录</a></li>
                    <li class="logo page-scroll"><a href=""><img src="imgs/logo.png"></a></li>
                    <li class="page-scroll" id="right_btn"><a href="signup.html">注册</a></li>
                    <li id="right_btn2"><a href=""></a></li>
                    <li id="right_btn3"><a href=""></a></li>
                    <li id="right_btn4"><a href=""></a></li>
                </ul>
                <a href="#" id="pull"><img src="imgs/nav-icon.png"></a>
            </div>
            <div class="clearfix"></div>
        </div>
    </div>
</div>
<div class="slider_bg" id="mainContainer">
    <div class="container">
        <div id="content">
             <div class="word"><h1>TIME TO READ</h1>
                 <div class="searchBox">
                    <link href="http://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
                    <form method="post" action="<%=request.getContextPath()%>/getappbykeyword.search">
                        <input type="text" name="keyword" placeholder="请输入您要搜索的图书...">
                        <button type="submit"></button>
                    </form>
                 </div>
                 <script>
                 let loginJson = {
                 "msg": null,
                 "type": null
                 };
                 console.log(findJson);
                 console.log(JSON.stringify(findJson));
                 $.ajax({
                 type: "POST",
                 url: "http://localhost:8080/service/find.book",
                 contentType: "application/json; charset=utf-8",
                 data: JSON.stringify(loginJson),
                 dataType: "json",
                 success: function (res) {
                 console.log(res);
                 //如果获取不到用户类别则为登录失败
                 if (res.msg==="ERROR_INPUTDATA" ) {
                 alert("数据传输失败")
                 }else if(res.msg==="ERROR_ACCOUNT"){
                 alert("用户名有误")
                 }else if(res.msg==="ERROR_PWD"){
                 alert("密码错误")
                 }else if(res.msg===("ERROR_SERVER")){
                 alert("服务器内部错误")
                 }
                 else if(res.msg==="SUCCESS"){//登录成功
                 //设置登录类别
                 sessionStorage.setItem("userType", res.type);
                 sessionStorage.setItem("userName", res.name);
                 sessionStorage.setItem("userAccount",  $("#account").val());
                 //alert(res.type+res.name);
                 //alert(window.location.href.substring(0, window.location.href.lastIndexOf('/')) + "/main.html")
                 window.location.replace(window.location.href.substring(0, window.location.href.lastIndexOf('/')) + "/main.html")

                 }
                 },
                 error: function (XMLHttpRequest, textStatus) {
                 alert("与服务器通讯失败！请刷新重试！");
                 console.error(textStatus + ":" + XMLHttpRequest.status + " " + XMLHttpRequest.readyState);
                 }

                 })
                 }

                 </script>
                 <div class="mainBox">
                     <div class="newBook">
                         <div class="bookTip"><img src="imgs/xssj.png"></div>
                         <div class="bookInfo">
                             <table>
                             <tr style="height: 40px; ">
                                 <th>封面</th>
                                 <th>书名</th>
                                 <th>作者</th>
                                 <th style="text-align: center;">出版社</th>
                                 <th style="text-align: center;">更多</th>
                             </tr>
                                 <c:forEach items="${book}" var="book">
                                     <tr style="height: 40px; ">
                                         <td id="img"><img src="${book.img}" style="width:80px;height: 80px;" href="#" onclick="window.open('<%=request.getContextPath()%>/bookinformation/${book.id}.manager', '书本详情',
                                        'height=700, width=600, toolbar =no, menubar=no, scrollbars=no, resizable=no, location=no, status=no')"/></td>
                                         <td id="name">${book.name}</td>
                                         <td id="author">${book.author}</td>
                                         <td id="publisher">${book.publisher}</td>
                                         <td id="info"><a href="${book.bookinformationUrl}">查看详情</a></td>
                                     </tr>
                                 </c:forEach>
                             </table>>
                         </div>
                     </div>

                   <!--
                   <div class="bookTypeBox">
                        <table>
                            <tr>
                                <td><img src="imgs/tskx.jpg"></td>
                                <td>
                                    <ul>
                                        <li><a herf="">哲学</a></li>
                                        <li>文学</li>
                                        <li>艺术</li>
                                        <li>军事</li>
                                        <li>政治</li>
                                        <li>历史</li>
                                    </ul>
                                </td>
                            </tr>
                        </table>
                    </div>-->

                 </div>
             </div>
        </div>
    </div>
</div>
<div class="footer_bg" id="contact">
    <div class="container"></div>
</div>
<div class="footer1_bg">
    <div class="container">
        <div class="row  footer">
            <div class="copy text-center">
                <p class="link"><span>Copyright &copy; 2019.NJUST All rights reserved.</span></p>
                <a href="#home" id="toTop" style="display: block;"><span id="toTopHover" style="opacity: 1;"> </span></a>
            </div>
        </div>
    </div>
</div>
<script type = "text/javascript">
    window.onload = function()
    {

        var account=sessionStorage.getItem("userAccount")
        var realname=sessionStorage.getItem("userName")
        var usertype=sessionStorage.getItem("userType")
        //alert(account+";"+realname+";"+usertype)
        if(usertype===null){

        }else if(usertype==="admin"){
            //alert("IS ADMIN");
            var txt1="<a href=\"bookin.html\">录入书籍</a>";
            var txt2="<a href=\"recordfind.html\">查询记录</a>";
            var txt4="<a >"+"欢迎使用："+"</a>";
            var txtlogout="<input type=\"button\" value=\"注 销\" class=\"buttom\" onclick='logout()'/>"
            $("#right_btn2").html(txt4);
            $("#right_btn3").html("<a >"+realname+"</a>");
            $("#right_btn4").html(txtlogout);
            $("#left_btn").html(txt1);
            $("#right_btn").html(txt2);

        }else if(usertype==="user"){
            var txt1="<a href=\"borrow.html\">借书</a>";
            var txt2="<a href=\"return.html\">还书</a>";
            var txt4="<a >"+"欢迎使用："+"</a>";
            var txtlogout="<input type=\"button\" value=\"注 销\" class=\"buttom\" onclick='logout()'/>"
            $("#right_btn2").html(txt4);
            $("#right_btn3").html("<a >"+realname+"</a>");
            $("#right_btn4").html(txtlogout);
            $("#left_btn").html(txt1);
            $("#right_btn").html(txt2);
        }
    }
function  logout() {
    sessionStorage.removeItem("userAccount")
    sessionStorage.removeItem("userName")
    sessionStorage.removeItem("userType")
    window.location.replace(window.location.href.substring(0, window.location.href.lastIndexOf('/')) + "/main.html")
}
</script>
<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js" crossorigin="anonymous"></script>
<script src="https://cdn.bootcss.com/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
<script src="https://cdn.bootcss.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
</body>
</html>