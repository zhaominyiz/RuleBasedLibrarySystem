<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>图书管理系统</title>
    <link rel="stylesheet" type="text/css" href="css/global.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/bootstrap.css">
</head>
<body>

<div class="header_bg" id="home">
    <div class="container">
        <div class="row header text-center specials">
            <div class="h_logo">
                <img src="imgs/logo.png" alt="" class="responsive"/>
            </div>
            <div class="top-nav" id="nav">
                <ul class="top-nav nav-list">
                    <li id="left_btn4"><a href=""></a></li>
                    <li id="left_btn3"><a href=""></a></li>
                    <li id="left_btn2"><a href=""></a></li>
                    <li><a href="login.html" id="left_btn">登录</a></li>
                    <li class="logo page-scroll"><a href=""><img src="imgs/logo.png"></a></li>
                    <li class="page-scroll" id="right_btn"><a href="signup.html">注册</a></li>
                    <li id="right_btn2"><a href=""></a></li>
                    <li id="right_btn3"><a href=""></a></li>
                    <li id="right_btn4"><a href=""></a></li>
                </ul>
                <a href="#" id="pull"><img src="imgs/nav-icon.png"></a>
            </div>
            <div class="clearfix"></div>
        </div>
    </div>
</div>
<div class="slider_bg" id="mainContainer">
    <div class="container">
        <div id="content">
             <div class="word"><h1>TIME TO READ</h1>
                 <div class="searchBox">
                    <link href="http://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
                    <form>
                        <input type="text" name="keyword" id="keyword" placeholder="请输入您要搜索的图书...">
                        <input style="color: aliceblue; " type="button" value="搜 索" class="buttom" onclick="getbooklist()"/>
                    </form>
                 </div>
                 <div class="mainBox">
                     <div class="newBook">
                         <div class="bookTip"><img src="imgs/xssj.png"></div>
                         <div class="bookInfo">
                             <table id="booklist">
                             <tr style="height: 40px; ">
                                 <th>封面</th>
                                 <th>书名</th>
                                 <th>作者</th>
                                 <th style="text-align: center;">出版社</th>
                                 <th style="text-align: center;">更多</th>
                             </tr>
                             </table>>
                         </div>
                     </div>

                 </div>
             </div>
        </div>
    </div>
</div>
<div class="footer_bg" id="contact">
    <div class="container"></div>
</div>
<div class="footer1_bg">
    <div class="container">
        <div class="row  footer">
            <div class="copy text-center">
                <p class="link"><span>Copyright &copy; 2019.NJUST All rights reserved.</span></p>
                <a href="#home" id="toTop" style="display: block;"><span id="toTopHover" style="opacity: 1;"> </span></a>
            </div>
        </div>
    </div>
</div>
<script type = "text/javascript">

    window.onload = function()
    {
        var account=sessionStorage.getItem("userAccount")
        var realname=sessionStorage.getItem("userName")
        var usertype=sessionStorage.getItem("userType")
        //alert(account+";"+realname+";"+usertype)
        if(usertype===null){

        }else if(usertype==="admin"){
            //alert("IS ADMIN");
            var txt1="<a href=\"bookin.html\">录入书籍</a>";
            var txt2="<a href=\"recordfind.html\">查询记录</a>";
            var txt4="<a >"+"欢迎使用："+"</a>";
            var txtlogout="<input type=\"button\" value=\"注 销\" class=\"buttom\" onclick='logout()'/>"
            $("#right_btn2").html(txt4);
            $("#right_btn3").html("<a >"+realname+"</a>");
            $("#right_btn4").html(txtlogout);
            $("#left_btn").html(txt1);
            $("#right_btn").html(txt2);

        }else if(usertype==="user"){
            var txt1="<a href=\"borrow.html\">借书</a>";
            var txt2="<a href=\"return.html\">还书</a>";
            var txt4="<a >"+"欢迎使用："+"</a>";
            var txtlogout="<input type=\"button\" value=\"注 销\" class=\"buttom\" onclick='logout()'/>"
            $("#right_btn2").html(txt4);
            $("#right_btn3").html("<a >"+realname+"</a>");
            $("#right_btn4").html(txtlogout);
            $("#left_btn").html(txt1);
            $("#right_btn").html(txt2);
        }
        getIndexBook();
    }
    function getIndexBook() {
        let loginJson = {
            "msg":'gogogo'
        };
        $.ajax({
            type: "POST",
            url: "http://localhost:8080/service/show.book",
            contentType: "application/json; charset=utf-8",
            data:JSON.stringify(loginJson),
            dataType: "json",
            success: function (res) {
                console.log(res);
                $.each(res.booklist, function (index, object) {
                    var txt="<tr style=\"height: 40px; \"><td i><img src=\""+object.img+"\" style=\"width:60px;height: 80px;\" href=\"#\" onclick='getDetail(\"+object.isbn+\")'" +
                        "'height=700, width=600, toolbar =no, menubar=no, scrollbars=no, resizable=no, location=no, status=no')\"/></td>\n" +
                        " <td >"+object.bookname+"</td>\n" +
                        "<td >"+object.author+"</td>\n" +
                        "<td >"+object.publisher+"</td>\n" +
                        "<td i><a href=\"javascript:void(0)\" onclick='getDetail("+object.isbn+")'>查看详情</a></td>\n" +
                        "</tr>"
                    //alert(txt)
                    $("#booklist").append(txt);
                });
            },
            error: function (XMLHttpRequest, textStatus) {
                alert("与服务器通讯失败！请刷新重试！");
                alert(textStatus + ":" + XMLHttpRequest.status + " " + XMLHttpRequest.readyState);
            }

        })
    }
    function getbooklist() {
        let resultJson={
            "msg":$("#keyword").val(),
            "type":""
        };
        console.log(resultJson);
        //alert(JSON.stringify(resultJson));
        $.ajax({
            type: "POST",
            url: "http://localhost:8080/service/find.book",
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify(resultJson),
            dataType: "json",
            success: function (res) {
                console.log(res);
                if (res.msg==="ERROR_INPUTDATA" ) {
                    alert("数据传输失败")
                }else if(res.msg===("ERROR_SERVER")){
                    alert("服务器内部错误")
                }else if(res.msg=="SUCCESS"){
                    sessionStorage.setItem("keyword",$("#keyword").val());
                    sessionStorage.setItem("rescount",res.cnt);
                    sessionStorage.setItem("resultlist",res.booklist);
                    window.location.replace(window.location.href.substring(0, window.location.href.lastIndexOf('/')) + "/booksearch.html")
                }
            },
            error: function (XMLHttpRequest, textStatus) {
                alert("与服务器通讯失败！请刷新重试！");
                alert(textStatus + ":" + XMLHttpRequest.status + " " + XMLHttpRequest.readyState);
            }
        })

    }
function  logout() {
    sessionStorage.removeItem("userAccount")
    sessionStorage.removeItem("userName")
    sessionStorage.removeItem("userType")
    window.location.replace(window.location.href.substring(0, window.location.href.lastIndexOf('/')) + "/main.html")
}
</script>
<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js" crossorigin="anonymous"></script>
<script src="https://cdn.bootcss.com/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
<script src="https://cdn.bootcss.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
</body>
</html>